<script
  type="text/x-handlebars"
  data-template-name="/connectors/below-site-header/custom-banner"
>
  <div class="hero-banner">
    <div class="artifact-right"></div>
    <div class="artifact-left"></div>
    <h1 style="margin-bottom: 24px">{{theme-i18n "banner.title_welcome"}} <span>{{theme-i18n "banner.title"}}</span></h1>
    <h4 style="margin-bottom: 24px">{{theme-i18n "banner.subtitle"}}</h4>
    <button aria-label="Themes" id="ember190" class="themes-tab tab btn-radical active btn btn-text ember-view" type="button"><span class="d-button-label">{{theme-i18n "banner.cta"}}</span>
    </button>
  </div>
</script>

<script type="text/discourse-plugin" version="0.8">
  const { iconNode } = require("discourse-common/lib/icon-library");

  api.decorateWidget("header-buttons:after", helper => {
    if (!api.getCurrentUser()) return;

    let container = api.container,
      ntb_text = settings.New_topic_button_text,
      ntb_title = settings.New_topic_button_title.length
        ? settings.New_topic_button_title
        : ntb_text,
      ntb_icon = settings.New_topic_button_icon,
      ntb_button_class = "btn btn-default btn btn-icon-text",
      ntb_button_helper = "button#new-create-topic",
      ntb_label_helper = "span.d-button-label",
      composerModal = require("discourse/models/composer").default,
      composerController = container.lookup("controller:composer");

    const createTopic = function() {
      const controller = container.lookup("controller:navigation/category"),
        category = controller.get("category.id"),
        topicCategory = container
          .lookup("route:topic")
          .get("context.category.id"),
        categoryd = topicCategory ? topicCategory : category;

      composerController.open({
        action: composerModal.CREATE_TOPIC,
        categoryId: categoryd,
        draftKey: composerModal.DRAFT
      });
    };

    return helper.h(
      ntb_button_helper,
      {
        className: ntb_button_class,
        title: ntb_title,
        onclick: createTopic
      },
      [iconNode(ntb_icon), helper.h(ntb_label_helper, ntb_text)]
    );
  });
</script>
